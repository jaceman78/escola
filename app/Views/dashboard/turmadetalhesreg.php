<?php 
$this->extend('dashboard/layout/dashboard-layout');
$this->section('content');
?>


<!-- Main content -->


<div class="col-12 col-sm-12">
      <div class="card card-primary card-outline card-outline-tabs">
        <div class="card-header p-0 border-bottom-0">
          <ul class="nav nav-tabs" id="custom-tabs-four-tab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="custom-tabs-four-home-tab" data-toggle="pill" href="#custom-tabs-four-home" role="tab" aria-controls="custom-tabs-four-home" aria-selected="true">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="custom-tabs-four-disciplinas-tab" data-toggle="pill" href="#custom-tabs-four-disciplinas" role="tab" aria-controls="custom-tabs-four-disciplinas" aria-selected="false">Disciplinas</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="custom-tabs-four-professores-tab" data-toggle="pill" href="#custom-tabs-four-professores" role="tab" aria-controls="custom-tabs-four-professores" aria-selected="false">Professores</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="custom-tabs-four-avaliacao-tab" data-toggle="pill" href="#custom-tabs-four-avaliacao" role="tab" aria-controls="custom-tabs-four-avaliacao" aria-selected="false">Avaliação</a>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content" id="custom-tabs-four-tabContent">
            <div class="tab-pane fade active show" id="custom-tabs-four-home" role="tabpanel" aria-labelledby="custom-tabs-four-home-tab">
             
          </div>
            <div class="tab-pane fade" id="custom-tabs-four-disciplinas" role="tabpanel" aria-labelledby="custom-tabs-four-disciplinas-tab">
            Disciplinas:    
            
            </div>
            <div class="tab-pane fade" id="custom-tabs-four-professores" role="tabpanel" aria-labelledby="custom-tabs-four-professores-tab">
            
            
            





<!-- Default box -->

          <div class="row">
            <div class="col-12 col-sm-6 col-md-6 d-flex align-items-stretch flex-column">
              <div class="card bg-light d-flex flex-fill">
                <div class="card-header text-muted border-bottom-0">
                  Digital Strategist
                </div>
                <div class="card-body pt-0">
                  <div class="row">
                    <div class="col-7">
                      <h2 class="lead"><b>Nicole Pearson</b></h2>
                      <p class="text-muted text-sm"><b>About: </b> Web Designer / UX / Graphic Artist / Coffee Lover </p>
                      <ul class="ml-4 mb-0 fa-ul text-muted">
                        <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Address: Demo Street 123, Demo City 04312, NJ</li>
                        <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Phone #: + 800 - 12 12 23 52</li>
                      </ul>
                    </div>
                    <div class="col-5 text-center">
                      <img src="../../dist/img/user1-128x128.jpg" alt="user-avatar" class="img-circle img-fluid">
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <div class="text-right">
                    <a href="#" class="btn btn-sm bg-teal">
                      <i class="fas fa-comments"></i>
                    </a>
                    <a href="#" class="btn btn-sm btn-primary">
                      <i class="fas fa-user"></i> View Profile
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-4 col-md-4 d-flex align-items-stretch flex-column">
              <div class="card bg-light d-flex flex-fill">
                <div class="card-header text-muted border-bottom-0">
                  Digital Strategist
                </div>
                <div class="card-body pt-0">
                  <div class="row">
                    <div class="col-7">
                      <h2 class="lead"><b>Nicole Pearson</b></h2>
                      <p class="text-muted text-sm"><b>About: </b> Web Designer / UX / Graphic Artist / Coffee Lover </p>
                      <ul class="ml-4 mb-0 fa-ul text-muted">
                        <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Address: Demo Street 123, Demo City 04312, NJ</li>
                        <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Phone #: + 800 - 12 12 23 52</li>
                      </ul>
                    </div>
                    <div class="col-5 text-center">
                      <img src="../../dist/img/user2-160x160.jpg" alt="user-avatar" class="img-circle img-fluid">
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <div class="text-right">
                    <a href="#" class="btn btn-sm bg-teal">
                      <i class="fas fa-comments"></i>
                    </a>
                    <a href="#" class="btn btn-sm btn-primary">
                      <i class="fas fa-user"></i> View Profile
                    </a>
                  </div>
                </div>
              </div>
            </div>
       
      
    
 
        <!-- /.card-body -->






            

          </div>
            <div class="tab-pane fade" id="custom-tabs-four-avaliacao" role="tabpanel" aria-labelledby="custom-tabs-four-avaliacao-tab">
                Pellentesque vestibulum commodo nibh nec blandit. Maecenas neque magna, iaculis tempus turpis ac, ornare sodales tellus. Mauris eget blandit dolor. Quisque tincidunt venenatis vulputate. Morbi euismod molestie tristique. Vestibulum consectetur dolor a vestibulum pharetra. Donec interdum placerat urna nec pharetra. Etiam eget dapibus orci, eget aliquet urna. Nunc at consequat diam. Nunc et felis ut nisl commodo dignissim. In hac habitasse platea dictumst. Praesent imperdiet accumsan ex sit amet facilisis.
            </div>
          </div>
        </div>
        <!-- /.card -->
      </div>
    </div>







<div id="card-container"></div>




<!-- /Main content -->

<!-- ADD modal content -->
<div id="data-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md">
    <div class="modal-content">
      <div class="text-center bg-info p-3" id="model-header">
        <h4 class="modal-title text-white" id="info-header-modalLabel"></h4>
      </div>
      <div class="modal-body">
        <form id="data-form" class="pl-3 pr-3">
          <div class="row">
            <input type="hidden" id="id_turmaprofessor" name="id_turmaprofessor" class="form-control" placeholder="Id turmaprofessor" maxlength="11" required>
						</div>
						<div class="row">
							<div class="col-md-12">
								<div class="form-group mb-3">
									<label for="turma_id" class="col-form-label"> Turma id: <span class="text-danger">*</span> </label>
									<input type="number" id="turma_id" name="turma_id" class="form-control" placeholder="Turma id" minlength="0"  maxlength="11" required>
								</div>
							</div>
							<div class="col-md-12">
								<div class="form-group mb-3">
									<label for="user_id" class="col-form-label"> User id: <span class="text-danger">*</span> </label>
									<input type="number" id="user_id" name="user_id" class="form-control" placeholder="User id" minlength="0"  maxlength="11" required>
								</div>
							</div>
							<div class="col-md-12">
								<div class="form-group mb-3">
									<label for="status" class="col-form-label"> Status: </label>
									<input type="number" id="status" name="status" class="form-control" placeholder="Status" minlength="0"  maxlength="11" >
								</div>
							</div>
						</div>

          <div class="form-group text-center">
            <div class="btn-group">
              <button type="submit" class="btn btn-success mr-2" id="form-btn"><?= lang("App.save") ?></button>
              <button type="button" class="btn btn-danger" data-bs-dismiss="modal"><?= lang("App.cancel") ?></button>
            </div>
          </div>
        </form>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>
<!-- /ADD modal content -->



<?= $this->endSection() ?>
<!-- /.content -->


<!-- page script -->
<?= $this->section("pageScript") ?>
<script>

// seleciona a lista existente a adiciona dinamicamente um novo item
let lista = document.querySelector('ul[name="itemturmaprofissinal"]');
// cria um novo elemento li
let novoItem = document.createElement('li');
novoItem.classList.add('nav-item');
// cria um novo elemento a
let novoLink = document.createElement('a');
novoLink.classList.add('nav-link');
novoLink.setAttribute('href', window.location.href);
// cria um novo elemento i
let novoIcon = document.createElement('i');
novoIcon.classList.add('fas', 'fa-dot-circle', 'nav-icon');
novoIcon.style.paddingLeft = '1em';
// cria um novo elemento p
let novoTexto = document.createElement('p');
novoTexto.innerText = 'Detalhes da turma '+'<?=$nomedaturma?>';
novoTexto.style.paddingLeft= '1em';

// adiciona o elemento i ao elemento a
novoLink.appendChild(novoIcon);
// adiciona o elemento p ao elemento a
novoLink.appendChild(novoTexto);
// adiciona o elemento a ao elemento li
novoItem.appendChild(novoLink);
// adiciona o novo elemento li à lista existente
lista.appendChild(novoItem);    



$(document).ready(function() {
    var id_turma = "<?php echo $idturma; ?>";
    $.ajax({
        url: "/turmadisciplina/getDisciplinaDetalhes/" + id_turma,
        type: "POST",
        dataType: "json",
        success: function(data) {
            var cards = "";
            data.forEach(function(turmaDisciplina) {
              if(turmaDisciplina.nomeprof==null)
                turmaDisciplina.nomeprof="Adicionar professor";
                cards += '<div class="card">';
                cards += '<div class="card-header">' + turmaDisciplina.disciplina_id + '</div>';
                cards += '<div class="card-body">';
                cards += '<h5 class="card-title">' + turmaDisciplina.turma_id + '</h5>';
                cards += '<p class="card-text">' + turmaDisciplina.carga_horaria + '</p>';
                cards += '<p class="card-text">' + turmaDisciplina.nomeprof + '</p>';
                cards += '</div>';
                cards += '</div>';
            });
            $('#custom-tabs-four-disciplinas').html(cards);
        }
    });
});



$(document).ready(function() {
    var id_turma = "<?php echo $idturma; ?>";
    $.ajax({
        url: "/turmas/getTurmaDetalhes/" + id_turma,
        type: "POST",
        dataType: "json",
        success: function(data) {
            var cards = "";
           
                cards += '<div class="card">';
                cards += '<div class="card-header">' + data[0].nome + '</div>';
                cards += '<div class="card-body">';
                cards += '<h5 class="card-title">' + data[0].nome_tipologia + '</h5>';
                cards += '<p class="card-text">' + data[0].nomedt + '</p>';
                cards += '<p class="card-text">' + data[0].email + '</p>';
                cards += '<p class="card-text">' + data[0].profile_img + '</p>';
                cards += '<p class="card-text">' + data[0].num_disciplinas + '</p>';
                cards += '</div>';
                cards += '</div>';
            
            $('#custom-tabs-four-home').html(cards);
        }
    });
});



  var urlController = '';
  var submitText = '';

  function getUrl() {
    return urlController;
  }

  function getSubmitText() {
    return submitText;
  }

  function save(id_turmaprofessor) {
    // reset the form 
    $("#data-form")[0].reset();
    $(".form-control").removeClass('is-invalid').removeClass('is-valid');
    if (typeof id_turmaprofessor === 'undefined' || id_turmaprofessor < 1) { //add
      urlController = '<?= base_url($controller . "/add") ?>';
      submitText = '<?= lang("App.save") ?>';
      $('#model-header').removeClass('bg-info').addClass('bg-success');
      $("#info-header-modalLabel").text('<?= lang("App.add") ?>');
      $("#form-btn").text(submitText);
      $('#data-modal').modal('show');
    } else { //edit
      urlController = '<?= base_url($controller . "/edit") ?>';
      submitText = '<?= lang("App.update") ?>';
      $.ajax({
        url: '<?php echo base_url($controller . "/getOne") ?>',
        type: 'post',
        data: {
          id_turmaprofessor: id_turmaprofessor
        },
        dataType: 'json',
        success: function(response) {
          $('#model-header').removeClass('bg-success').addClass('bg-info');
          $("#info-header-modalLabel").text('<?= lang("App.edit") ?>');
          $("#form-btn").text(submitText);
          $('#data-modal').modal('show');
          //insert data to form
          			$("#data-form #id_turmaprofessor").val(response.id_turmaprofessor);
			$("#data-form #turma_id").val(response.turma_id);
			$("#data-form #user_id").val(response.user_id);
			$("#data-form #status").val(response.status);

        }
      });
    }
    $.validator.setDefaults({
      highlight: function(element) {
        $(element).addClass('is-invalid').removeClass('is-valid');
      },
      unhighlight: function(element) {
        $(element).removeClass('is-invalid').addClass('is-valid');
      },
      errorElement: 'div ',
      errorClass: 'invalid-feedback',
      errorPlacement: function(error, element) {
        if (element.parent('.input-group').length) {
          error.insertAfter(element.parent());
        } else if ($(element).is('.select')) {
          element.next().after(error);
        } else if (element.hasClass('select2')) {
          //error.insertAfter(element);
          error.insertAfter(element.next());
        } else if (element.hasClass('selectpicker')) {
          error.insertAfter(element.next());
        } else {
          error.insertAfter(element);
        }
      },
      submitHandler: function(form) {
        var form = $('#data-form');
        $(".text-danger").remove();
        $.ajax({
          // fixBug get url from global function only
          // get global variable is bug!
          url: getUrl(),
          type: 'post',
          data: form.serialize(),
          cache: false,
          dataType: 'json',
          beforeSend: function() {
            $('#form-btn').html('<i class="fa fa-spinner fa-spin"></i>');
          },
          success: function(response) {
            if (response.success === true) {
              Swal.fire({
                toast: true,
                position: 'top-end',
                icon: 'success',
                title: response.professores,
                showConfirmButton: false,
                timer: 1500
              }).then(function() {
                $('#data_table').DataTable().ajax.reload(null, false).draw(false);
                $('#data-modal').modal('hide');
              })
            } else {
              if (response.professores instanceof Object) {
                $.each(response.professores, function(index, value) {
                  var ele = $("#" + index);
                  ele.closest('.form-control')
                    .removeClass('is-invalid')
                    .removeClass('is-valid')
                    .addClass(value.length > 0 ? 'is-invalid' : 'is-valid');
                  ele.after('<div class="invalid-feedback">' + response.professores[index] + '</div>');
                });
              } else {
                Swal.fire({
                  toast: false,
                  position: 'bottom-end',
                  icon: 'error',
                  title: response.professores,
                  showConfirmButton: false,
                  timer: 3000
                })

              }
            }
            $('#form-btn').html(getSubmitText());
          }
        });
        return false;
      }
    });

    $('#data-form').validate({

      //insert data-form to database

    });
  }



  function remove(id_turmaprofessor) {
    Swal.fire({
      title: "<?= lang("App.remove-title") ?>",
      text: "<?= lang("App.remove-text") ?>",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: '<?= lang("App.confirm") ?>',
      cancelButtonText: '<?= lang("App.cancel") ?>'
    }).then((result) => {

      if (result.value) {
        $.ajax({
          url: '<?php echo base_url($controller . "/remove") ?>',
          type: 'post',
          data: {
            id_turmaprofessor : id_turmaprofessor
          },
          dataType: 'json',
          success: function(response) {

            if (response.success === true) {
              Swal.fire({
                toast:true,
                position: 'top-end',
                icon: 'success',
                title: response.professores,
                showConfirmButton: false,
                timer: 1500
              }).then(function() {
                $('#data_table').DataTable().ajax.reload(null, false).draw(false);
              })
            } else {
              Swal.fire({
                toast:false,
                position: 'bottom-end',
                icon: 'error',
                title: response.professores,
                showConfirmButton: false,
                timer: 3000
              })
            }
          }
        });
      }
    })
  }
</script>


<?= $this->endSection() ?>
